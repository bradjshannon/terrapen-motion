# ESP32-S3 Controller for TerraPen Motion System
# Minimal viable firmware for OTA updates and Arduino flashing

[env:esp32-s3-zero]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
lib_deps = 
    bblanchon/ArduinoJson@^7.0.0

build_flags = 
    -D ARDUINO_ESP32S3_DEV
    -D UART_NANO_RX=44
    -D UART_NANO_TX=43

monitor_speed = 115200
monitor_filters = esp32_exception_decoder

# OTA upload configuration (for ESP32 firmware updates)
upload_protocol = esptool
upload_port = /dev/ttyUSB0  # Adjust for your system

# Arduino Nano upload via ESP32 bridge
[env:arduino-via-esp32]
platform = atmelavr
board = nanoatmega328
framework = arduino
lib_deps = 
    Servo
    bblanchon/ArduinoJson@^7.0.0

# Custom upload command that uses ESP32 as programmer
upload_protocol = custom
upload_command = python $PROJECT_DIR/scripts/upload_via_esp32.py $SOURCE

# Source files from nano-firmware
src_dir = ../nano-firmware/src
build_flags = 
    -D ARDUINO_AVR_NANO